{{- $authors := "authors" | index .Site.Data | default dict -}}
{{- $limit := .Data.Pages | len | cond (ge .Site.Config.Services.RSS.Limit 1) .Site.Config.Services.RSS.Limit -}}
{{- $pages := .Data.Pages | first $limit -}}

{{ "<?" | safeHTML }}xml version="1.0" encoding="UTF-8" standalone="yes"{{ "?>" | safeHTML }}
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>{{ if .Site.Title | eq .Title }}{{ .Site.Title }}{{ else }}{{ with .Title }}{{.}} &middot; {{ end }}{{ .Site.Title }}{{ end }}</title>
        <link>{{ .Permalink }}</link>
        <description>Recent content {{ if .Site.Title | ne .Title }}{{ with .Title }}in {{.}} {{ end }}{{ end }}on {{ .Site.Title }}</description>
        <generator>Hugo -- gohugo.io</generator>

        {{ with .Site.LanguageCode }}
            <language>{{ . }}</language>
        {{ end }}

        {{ with .Site.Author }}
            <managingEditor>{{ .email }}{{ with .name }} ({{ . }}){{ end }}</managingEditor>
            <webMaster>{{ .email }}{{ with .name }} ({{ . }}){{ end }}</webMaster>
        {{ end }}

        {{ with .Site.Copyright }}
            <copyright>{{ . }}</copyright>
        {{ end }}

        {{ if not .Date.IsZero }}
            <lastBuildDate>{{ .Date.Format "Mon, 02 Jan 2006 15:04:05 -0700" | safeHTML }}</lastBuildDate>
        {{ end }}

        {{ with .OutputFormats.Get "RSS" }}
            {{ printf "<atom:link rel=%q type=%q href=%q />" "self" .MediaType .Permalink | safeHTML }}
        {{ end }}

        {{ range $pages }}
            {{- $author := "author" | .Param | string | index $authors | default .Site.Author | default dict -}}
            {{- $data := .Language.Lang | index $author | default dict -}}

            <item>
                <title>{{ .Title }}</title>
                <link>{{ .Permalink }}</link>
                <pubDate>{{ .Date.Format "Mon, 02 Jan 2006 15:04:05 -0700" | safeHTML }}</pubDate>
                {{ with $author }}
                    <author>{{ "email" | index $data | default .email }}{{ with "name" | index $data | default .name }} ({{ . }}){{ end }}</author>
                {{ end }}
                <guid>{{ .Permalink }}</guid>
                <description>{{ .Summary | plainify }}</description>
            </item>
        {{ end }}
    </channel>
</rss>
