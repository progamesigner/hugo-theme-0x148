{{- slice . "amp-iframe" | partial "functions/is-amp-component-loaded.error" -}}

{{- $disqus := resources.Get "iframes/disqus.html" | resources.ExecuteAsTemplate "iframes/disqus.html" . | minify | fingerprint "sha512" -}}
{{- $properties := slice . | partial "functions/get-page-properties.dict" -}}

{{ if not .Site.Config.Privacy.Disqus.Disable | and .Site.Config.Services.Disqus.Shortname }}
    <amp-iframe
        width="640"
        height="160"
        layout="responsive"
        sandbox="allow-scripts allow-same-origin allow-modals allow-popups allow-forms"
        resizable
        src="{{ $disqus.Permalink | slice . | partial "functions/format-iframe-url.txt" }}#{{ $properties.canonical.hash }}"
    >
        <div class="has-text-centered" overflow placeholder>
            Comments powered by <a href="https://disqus.com">Disqus</a>.
        </div>
    </amp-iframe>
{{ end }}
